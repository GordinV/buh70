/*drop table if exists tmp_viitenr;
create table if not EXISTS tmp_viitenr_kustuta (ik text, asutus text, vn text);

insert into  tmp_viitenr_kustuta (ik, asutus, vn)
SELECT
    t.f[1]::text AS ik
        ,t.f[2]::text AS asutus
        ,t.f[3]::text AS vn
FROM (
         SELECT regexp_split_to_array(l, ';') AS f
         FROM regexp_split_to_table(
                      $$46803023713;0911027 Narva Lasteaed Pongerjas T;27012
46505153727;0911027 Narva Lasteaed Pongerjas T;27025
47104012216;0911027 Narva Lasteaed Pongerjas T;27038
45902043712;0911027 Narva Lasteaed Pongerjas T;27999
50710077069;0951004 Narva Muusikakool T;8100216
39806043736;0951004 Narva Muusikakool T;8100313
60610283729;0951004 Narva Muusikakool T;8100915
60906233718;0951004 Narva Muusikakool T;8101011
60106123778;0951004 Narva Muusikakool T;8102117
39909293713;0951004 Narva Muusikakool T;8102311
51010083711;0951002 Narva Kunstikool T;8200611
60409163733;0951002 Narva Kunstikool T;8200912
51002163715;0951002 Narva Kunstikool T;8201212
60408123722;0951002 Narva Kunstikool T;8201610
50503153731;0951002 Narva Kunstikool T;8201911
60409013736;0951002 Narva Kunstikool T;8202017
61103233714;0951002 Narva Kunstikool T;8202318
60609153721;0951002 Narva Kunstikool T;8204510
50312173716;0951002 Narva Kunstikool T;8206916
50411213711;0951002 Narva Kunstikool T;8207119
49711283731;0951002 Narva Kunstikool T;8208312
60405093717;0951002 Narva Kunstikool T;8208613
60410293719;0951002 Narva Kunstikool T;8209214
46310050271;0951002 Narva Kunstikool T;8209418
48010263711;0951002 Narva Kunstikool T;8209515
51309300144;0951002 Narva Kunstikool T;8209719
37211023712;0951002 Narva Kunstikool T;8209816
50905107013;0951002 Narva Kunstikool T;8212913
50607073718;0951002 Narva Kunstikool T;8214911
60201193752;0951002 Narva Kunstikool T;8215017
60401113757;0951002 Narva Kunstikool T;8215211
50409293726;0951002 Narva Kunstikool T;8215716
60309243711;0951002 Narva Kunstikool T;8215910
60312043734;0951002 Narva Kunstikool T;8216113
60211043737;0951002 Narva Kunstikool T;8216210
50303123748;0951002 Narva Kunstikool T;8216317
60512130890;0951002 Narva Kunstikool T;8218315
60810030011;0951002 Narva Kunstikool T;8222615
60202223736;0951002 Narva Kunstikool T;8222712
51003317048;0951002 Narva Kunstikool T;8223517
61110213744;0951002 Narva Kunstikool T;8223614
60905273719;0951002 Narva Kunstikool T;8224215
61302010143;0951002 Narva Kunstikool T;8225117
61101073717;0951002 Narva Kunstikool T;8226213
60707253720;0951002 Narva Kunstikool T;8228512
61103263713;0951002 Narva Kunstikool T;8228910
61306130128;0951002 Narva Kunstikool T;8230212
60209123754;0951002 Narva Kunstikool T;8232113
49910013715;0951004 Narva Muusikakool T;8411015
49910113732;0951004 Narva Muusikakool T;8411413
49908293742;0951004 Narva Muusikakool T;8412713
60210153734;0951004 Narva Muusikakool T;8412917
60607143748;0951004 Narva Muusikakool T;8413217
50603273732;0951004 Narva Muusikakool T;8413819
49811193724;0951004 Narva Muusikakool T;8414119
49805313718;0951004 Narva Muusikakool T;8414614
61103173747;0951004 Narva Muusikakool T;8414818
60611093729;0951004 Narva Muusikakool T;8415011
60607033713;0951004 Narva Muusikakool T;8415817
60610022722;0951004 Narva Muusikakool T;8416010
60608312725;0951004 Narva Muusikakool T;8418115
49809293722;0951004 Narva Muusikakool T;8418513
60201313719;0951004 Narva Muusikakool T;8418814
39705163737;0951004 Narva Muusikakool T;8419017
49807183710;0951004 Narva Muusikakool T;8419716
51307110205;0951004 Narva Muusikakool T;8420213
50608013714;0951004 Narva Muusikakool T;8420611
49912303769;0951004 Narva Muusikakool T;8420912
50208193713;0951004 Narva Muusikakool T;8421115
39902253738;0951004 Narva Muusikakool T;8421319
50405133713;0951004 Narva Muusikakool T;8422415
60004193739;0951004 Narva Muusikakool T;8422619
49607295243;0951004 Narva Muusikakool T;8422910
60111243735;0951004 Narva Muusikakool T;8423414
50010243737;0951004 Narva Muusikakool T;8424316
48606270041;0951004 Narva Muusikakool T;8424617
49912193732;0951004 Narva Muusikakool T;8425218
39804113722;0951004 Narva Muusikakool T;8426110
39810093712;0951004 Narva Muusikakool T;8426411
60702143715;0951004 Narva Muusikakool T;8429214
39909013711;0951004 Narva Muusikakool T;8430012
61307280010;0951004 Narva Muusikakool T;8430313
39808313710;0951004 Narva Muusikakool T;8432311
49409113725;0951004 Narva Muusikakool T;8433213
60810293731;0951004 Narva Muusikakool T;8433514
60209123732;0951004 Narva Muusikakool T;8434513
51506190142;0951004 Narva Muusikakool T;8436210
60805063730;0951004 Narva Muusikakool T;8437112
50804263725;0951004 Narva Muusikakool T;8438315
39905103734;0951004 Narva Muusikakool T;8438917
50301033717;0951004 Narva Muusikakool T;8439110
50103113724;0951004 Narva Muusikakool T;8439518
60204223735;0951004 Narva Muusikakool T;8439712
60608312714;0951004 Narva Muusikakool T;8441713
50608236012;0951004 Narva Muusikakool T;8442013
50206213748;0951004 Narva Muusikakool T;8442411
50203110246;0951004 Narva Muusikakool T;8443313
60402203728;0951004 Narva Muusikakool T;8443711
60204073714;0951004 Narva Muusikakool T;8444613
60012233741;0951004 Narva Muusikakool T;8445418
60310233740;0951004 Narva Muusikakool T;8446310
50503313715;0951004 Narva Muusikakool T;8446815
60106277024;0951004 Narva Muusikakool T;8448415
60308243728;0951004 Narva Muusikakool T;8449919
60112300226;0951004 Narva Muusikakool T;8451716
50202223724;0951004 Narva Muusikakool T;8452414
50512033710;0951004 Narva Muusikakool T;8453219
60810243718;0951004 Narva Muusikakool T;8454014
50403223724;0951004 Narva Muusikakool T;8454218
61210023742;0951004 Narva Muusikakool T;8456517
61406060113;0951004 Narva Muusikakool T;8456711
38408293713;0951004 Narva Muusikakool T;8458719
60007133734;0951004 Narva Muusikakool T;8459310
60208083730;0951004 Narva Muusikakool T;8459611
60207103729;0951004 Narva Muusikakool T;8459912
60201043722;0951004 Narva Muusikakool T;8460118
50106183711;0951004 Narva Muusikakool T;8461010
50009063725;0951004 Narva Muusikakool T;8463513
50008093719;0951004 Narva Muusikakool T;8464114
50301153715;0951004 Narva Muusikakool T;8464619
50101053736;0951004 Narva Muusikakool T;8465113
50204190229;0951004 Narva Muusikakool T;8465812
39909280280;0951004 Narva Muusikakool T;8466714
50402123713;0951004 Narva Muusikakool T;8467014
50011033712;0951004 Narva Muusikakool T;8468013
49811073715;0951004 Narva Muusikakool T;8469614
50010243737;0951004 Narva Muusikakool T;8470111
48802223713;0951004 Narva Muusikakool T;8470412
39809203713;0951004 Narva Muusikakool T;8474719
49909013723;0951004 Narva Muusikakool T;8476115
50312223720;0951004 Narva Muusikakool T;8480619
50212153754;0951004 Narva Muusikakool T;8481210
60308243728;0951004 Narva Muusikakool T;8481511
60511080868;0951004 Narva Muusikakool T;8485313
38004193725;0951004 Narva Muusikakool T;8489717
50611212713;0951004 Narva Muusikakool T;8490214
39110112242;0951004 Narva Muusikakool T;8490515
50503153720;0951004 Narva Muusikakool T;8492018
49501173763;0951004 Narva Muusikakool T;8495219
39908043755;0951004 Narva Muusikakool T;8495617
60411103710;0951004 Narva Muusikakool T;8495811
39905173745;0951004 Narva Muusikakool T;8496014
51008263712;0951004 Narva Muusikakool T;8496218
50512033710;0951004 Narva Muusikakool T;8496519
60805203711;0810203 Narva Paemurru Spordikool T;8500081
39711193720;0810203 Narva Paemurru Spordikool T;8500117
60908243746;0810203 Narva Paemurru Spordikool T;8500120
50507033714;0810203 Narva Paemurru Spordikool T;8500162
60708053713;0810203 Narva Paemurru Spordikool T;8500191
61108273723;0810203 Narva Paemurru Spordikool T;8500272
50706103717;0810203 Narva Paemurru Spordikool T;8500285
51112050081;0810203 Narva Paemurru Spordikool T;8500324
60901203738;0810203 Narva Paemurru Spordikool T;8500353
50301223711;0810203 Narva Paemurru Spordikool T;8500366
61112233713;0810203 Narva Paemurru Spordikool T;8500379
60702283727;0810203 Narva Paemurru Spordikool T;8500395
39704043723;0810203 Narva Paemurru Spordikool T;8500418
61203183713;0810203 Narva Paemurru Spordikool T;8500447
60403233732;0810203 Narva Paemurru Spordikool T;8500502
61111033735;0810203 Narva Paemurru Spordikool T;8500531
61009173719;0810203 Narva Paemurru Spordikool T;8500573
50904113731;0810203 Narva Paemurru Spordikool T;8500683
50107193712;0810203 Narva Paemurru Spordikool T;8500764
61306057017;0810203 Narva Paemurru Spordikool T;8509354
50106163719;0810203 Narva Paemurru Spordikool T;8510660
50010053710;0810203 Narva Paemurru Spordikool T;8510961
51209043728;0810203 Narva Paemurru Spordikool T;8511436
50509063718;0810203 Narva Paemurru Spordikool T;8514048
50803293719;0810203 Narva Paemurru Spordikool T;8515458
60707202820;0810203 Narva Paemurru Spordikool T;8515542
60502203720;0810203 Narva Paemurru Spordikool T;8515555
61503170082;0810203 Narva Paemurru Spordikool T;8518196
60606067118;0810203 Narva Paemurru Spordikool T;8518471
50801043746;0810203 Narva Paemurru Spordikool T;8525082
60108173726;0810203 Narva Paemurru Spordikool T;8525118
51302130020;0810203 Narva Paemurru Spordikool T;8526256
50810203711;0810203 Narva Paemurru Spordikool T;8528005
60701153728;0810203 Narva Paemurru Spordikool T;8529457
49906123732;0810203 Narva Paemurru Spordikool T;8529910
50806043710;0810203 Narva Paemurru Spordikool T;8531937
61209013721;0810203 Narva Paemurru Spordikool T;8533605
61105283737;0810203 Narva Paemurru Spordikool T;8533906
60603233738;0810203 Narva Paemurru Spordikool T;8534426
50601033726;0810203 Narva Paemurru Spordikool T;8537591
50709182758;0810203 Narva Paemurru Spordikool T;8539997
51108303723;0810203 Narva Paemurru Spordikool T;8545693
51203043722;0810203 Narva Paemurru Spordikool T;8555599
90007129999;0810203 Narva Paemurru Spordikool T;8558253
61312040081;0810203 Narva Paemurru Spordikool T;8561949
61412250059;0810203 Narva Paemurru Spordikool T;8563141
50701233722;0810203 Narva Paemurru Spordikool T;8585048
60910063712;0810203 Narva Paemurru Spordikool T;8590075
61201213715;0810203 Narva Paemurru Spordikool T;8590266
61109153721;0810203 Narva Paemurru Spordikool T;8590761
50407273724;0810203 Narva Paemurru Spordikool T;8590839
50604103715;0810203 Narva Paemurru Spordikool T;8590965
50504253731;0810204 Narva Spordikool Energia T;8600392
50612193717;0810204 Narva Spordikool Energia T;8610175
50503223760;0810204 Narva Spordikool Energia T;8620275
50602143711;0810204 Narva Spordikool Energia T;8625089
50707223710;0810204 Narva Spordikool Energia T;8641872
60602143723;0810204 Narva Spordikool Energia T;8649379
50305170213;0810204 Narva Spordikool Energia T;8662563
39903223711;0810204 Narva Spordikool Energia T;8679132
50501073718;0810204 Narva Spordikool Energia T;8694489
60807213728;0951006 Narva Noorte Meremeeste Klubi T;8700713
50506143750;0951006 Narva Noorte Meremeeste Klubi T;8701615
60111183713;0951006 Narva Noorte Meremeeste Klubi T;8710910
49907023720;0951006 Narva Noorte Meremeeste Klubi T;8711715
61002123715;0951006 Narva Noorte Meremeeste Klubi T;8711919
50908023730;0951006 Narva Noorte Meremeeste Klubi T;8713218
60308020831;0951006 Narva Noorte Meremeeste Klubi T;8713519
50907063717;0951006 Narva Noorte Meremeeste Klubi T;8715711
50910223728;0951006 Narva Noorte Meremeeste Klubi T;8720418
60804223720;0951006 Narva Noorte Meremeeste Klubi T;8720719
60911053710;0951006 Narva Noorte Meremeeste Klubi T;8721417
51107170110;0951006 Narva Noorte Meremeeste Klubi T;8722319
61109153721;0951006 Narva Noorte Meremeeste Klubi T;8723716
50204293739;0951006 Narva Noorte Meremeeste Klubi T;8727110
50907073716;0951006 Narva Noorte Meremeeste Klubi T;8727314
60702033713;0951006 Narva Noorte Meremeeste Klubi T;8732011
39812233714;0951006 Narva Noorte Meremeeste Klubi T;8732419
50105103738;0951006 Narva Noorte Meremeeste Klubi T;8732710
50910050038;0951006 Narva Noorte Meremeeste Klubi T;8733117
61004023719;0820201 Kultuurimaja Rugodiv T;8801719
61202283736;0820201 Kultuurimaja Rugodiv T;8802417
60602143745;0820201 Kultuurimaja Rugodiv T;8802514
60603093735;0820201 Kultuurimaja Rugodiv T;8802815
50104033737;0820201 Kultuurimaja Rugodiv T;8803319
51412250079;0820201 Kultuurimaja Rugodiv T;8803814
38509252217;0820201 Kultuurimaja Rugodiv T;8804211
60103183724;0820201 Kultuurimaja Rugodiv T;8805618
60209063721;0820201 Kultuurimaja Rugodiv T;8805715
61411220153;0820201 Kultuurimaja Rugodiv T;8805919
60810223726;0820201 Kultuurimaja Rugodiv T;8807616
60907313715;0820201 Kultuurimaja Rugodiv T;8808217
60011173736;0820201 Kultuurimaja Rugodiv T;8808615
51205213712;0820201 Kultuurimaja Rugodiv T;8809119
51407040201;0820201 Kultuurimaja Rugodiv T;8809711
60809163712;0820201 Kultuurimaja Rugodiv T;8810014
60901052219;0820201 Kultuurimaja Rugodiv T;8810111
51204053734;0820201 Kultuurimaja Rugodiv T;8810315
60412143732;0820201 Kultuurimaja Rugodiv T;8810519
51206040093;0820201 Kultuurimaja Rugodiv T;8811411
60112223715;0820201 Kultuurimaja Rugodiv T;8811712
61407070016;0820201 Kultuurimaja Rugodiv T;8812012
49306187014;0820201 Kultuurimaja Rugodiv T;8812119
60302173724;0820201 Kultuurimaja Rugodiv T;8812818
61310250024;0820201 Kultuurimaja Rugodiv T;8813312
51303280251;0820201 Kultuurimaja Rugodiv T;8813419
61210260104;0820201 Kultuurimaja Rugodiv T;8813613
60410043727;0820201 Kultuurimaja Rugodiv T;8813817
61202043751;0820201 Kultuurimaja Rugodiv T;8814214
61208103726;0820201 Kultuurimaja Rugodiv T;8816115
51204080092;0820201 Kultuurimaja Rugodiv T;8816513
60701147034;0820201 Kultuurimaja Rugodiv T;8817512
47006193717;0820201 Kultuurimaja Rugodiv T;8818016
60811243745;0820201 Kultuurimaja Rugodiv T;8819413
61403060088;0820201 Kultuurimaja Rugodiv T;8819510
51111260153;0820201 Kultuurimaja Rugodiv T;8819918
61202202716;0820201 Kultuurimaja Rugodiv T;8820114
46401013728;0820201 Kultuurimaja Rugodiv T;8822219
61011293725;0820201 Kultuurimaja Rugodiv T;8822413
61211223748;0820201 Kultuurimaja Rugodiv T;8824217
50704113736;0820201 Kultuurimaja Rugodiv T;8825517
61212280183;0820201 Kultuurimaja Rugodiv T;8826215
48110143716;0820201 Kultuurimaja Rugodiv T;8826613
49811203722;0820201 Kultuurimaja Rugodiv T;8826914
60804240013;0820201 Kultuurimaja Rugodiv T;8827117
61104113743;0820201 Kultuurimaja Rugodiv T;8829717
60310143719;0820201 Kultuurimaja Rugodiv T;8830816
61203163721;0820201 Kultuurimaja Rugodiv T;8832319
61605050042;0820201 Kultuurimaja Rugodiv T;8836519
60608203718;0820201 Kultuurimaja Rugodiv T;8837411
61612010123;0820201 Kultuurimaja Rugodiv T;8838313
60606053722;0820201 Kultuurimaja Rugodiv T;8838517
51111193710;0820201 Kultuurimaja Rugodiv T;8842613
33905103722;0820201 Kultuurimaja Rugodiv T;8849917
61007023734;0820201 Kultuurimaja Rugodiv T;8851617
60501253717;0820201 Kultuurimaja Rugodiv T;8853916
61510260157;0820201 Kultuurimaja Rugodiv T;8854119
61011243712;0820201 Kultuurimaja Rugodiv T;8856117
60607303732;0820201 Kultuurimaja Rugodiv T;8856816
60509263720;0820201 Kultuurimaja Rugodiv T;8857611
60412172756;0820201 Kultuurimaja Rugodiv T;8863414
60710053710;0820201 Kultuurimaja Rugodiv T;8866110
49507213713;0820201 Kultuurimaja Rugodiv T;8871215
60212233714;0820201 Kultuurimaja Rugodiv T;8871419
50712083729;0820201 Kultuurimaja Rugodiv T;8871613
51303220090;0951005 Narva Laste Loomemaja T;8900018
61503170082;0951005 Narva Laste Loomemaja T;8900047
60507253747;0951005 Narva Laste Loomemaja T;8900050
61209183721;0951005 Narva Laste Loomemaja T;8900131
50709057019;0951005 Narva Laste Loomemaja T;8900254
61106163733;0951005 Narva Laste Loomemaja T;8900322
60905083736;0951005 Narva Laste Loomemaja T;8900429
60607313750;0951005 Narva Laste Loomemaja T;8900458
50810193713;0951005 Narva Laste Loomemaja T;8900539
61005203711;0951005 Narva Laste Loomemaja T;8900584
61306280310;0951005 Narva Laste Loomemaja T;8900607
61005203711;0951005 Narva Laste Loomemaja T;8900610
61011143717;0951005 Narva Laste Loomemaja T;8900649
61009043725;0951005 Narva Laste Loomemaja T;8900665
61009233730;0951005 Narva Laste Loomemaja T;8900678
61009213738;0951005 Narva Laste Loomemaja T;8900681
50907103728;0951005 Narva Laste Loomemaja T;8900720
61211080155;0951005 Narva Laste Loomemaja T;8900843
61012083711;0951005 Narva Laste Loomemaja T;8900885
50801173744;0951005 Narva Laste Loomemaja T;8900924
50801173744;0951005 Narva Laste Loomemaja T;8900940
50107193712;0951005 Narva Laste Loomemaja T;8901046
60512293721;0951005 Narva Laste Loomemaja T;8901101
60801093731;0951005 Narva Laste Loomemaja T;8901127
60307213713;0951005 Narva Laste Loomemaja T;8901237
48509090119;0951005 Narva Laste Loomemaja T;8901305
60304293743;0951005 Narva Laste Loomemaja T;8901392
60111123748;0951005 Narva Laste Loomemaja T;8901431
49410093712;0951005 Narva Laste Loomemaja T;8901509
60109033719;0951005 Narva Laste Loomemaja T;8901525
39901193733;0951005 Narva Laste Loomemaja T;8901567
39611303732;0951005 Narva Laste Loomemaja T;8901570
51309120186;0951005 Narva Laste Loomemaja T;8901897
51309120190;0951005 Narva Laste Loomemaja T;8901907
60612053717;0951005 Narva Laste Loomemaja T;8901936
60805233721;0951005 Narva Laste Loomemaja T;8901965
60803133716;0951005 Narva Laste Loomemaja T;8901981
51005097096;0951005 Narva Laste Loomemaja T;8902016
61111083710;0951005 Narva Laste Loomemaja T;8902061
61202202716;0951005 Narva Laste Loomemaja T;8902139
50904263717;0951005 Narva Laste Loomemaja T;8902304
60104113719;0951005 Narva Laste Loomemaja T;8902618
60012163712;0951005 Narva Laste Loomemaja T;8902647
60109183727;0951005 Narva Laste Loomemaja T;8902650
60103272721;0951005 Narva Laste Loomemaja T;8903950
50103123731;0951005 Narva Laste Loomemaja T;8903976
50205113726;0951005 Narva Laste Loomemaja T;8903992
50204063717;0951005 Narva Laste Loomemaja T;8904014
50106183711;0951005 Narva Laste Loomemaja T;8904056
60805133715;0951005 Narva Laste Loomemaja T;8904108
60707143737;0951005 Narva Laste Loomemaja T;8904577
61309130110;0951005 Narva Laste Loomemaja T;8905453
51506110021;0951005 Narva Laste Loomemaja T;8912705
60706173712;0951005 Narva Laste Loomemaja T;8915582
60511213715;0951005 Narva Laste Loomemaja T;8917441
61001140014;0951005 Narva Laste Loomemaja T;8917483
60703213738;0951005 Narva Laste Loomemaja T;8917535
61206293719;0951005 Narva Laste Loomemaja T;8925242
60905253727;0951005 Narva Laste Loomemaja T;8925297
61008063712;0951005 Narva Laste Loomemaja T;8925352
50411123734;0951005 Narva Laste Loomemaja T;8931281
60305263716;0951005 Narva Laste Loomemaja T;8931304
60406253728;0951005 Narva Laste Loomemaja T;8936558
50310313731;0951005 Narva Laste Loomemaja T;8938051
60808233714;0951005 Narva Laste Loomemaja T;8938077
50208133722;0951005 Narva Laste Loomemaja T;8938080
45408042229;0951005 Narva Laste Loomemaja T;8938789
60011193717;0951005 Narva Laste Loomemaja T;8938828
51310260139;0951005 Narva Laste Loomemaja T;8946153
61103043731;0951005 Narva Laste Loomemaja T;8946179
50212143714;0951005 Narva Laste Loomemaja T;8946182
61410150185;0951005 Narva Laste Loomemaja T;8946315
49604123735;0951005 Narva Laste Loomemaja T;8946360
60101303720;0951005 Narva Laste Loomemaja T;8946920
50511063737;0951005 Narva Laste Loomemaja T;8946933
60601103712;0951005 Narva Laste Loomemaja T;8946991
50611233710;0951005 Narva Laste Loomemaja T;8947055
50804303711;0951005 Narva Laste Loomemaja T;8947097
60212203726;0951005 Narva Laste Loomemaja T;8950259
50905183719;0951005 Narva Laste Loomemaja T;8950262
60901263736;0951005 Narva Laste Loomemaja T;8951588
60508123725;0951005 Narva Laste Loomemaja T;8953625
46103283735;0951005 Narva Laste Loomemaja T;8954352
60811123725;0951005 Narva Laste Loomemaja T;8955526
60506277014;0951005 Narva Laste Loomemaja T;8955898
61407090117;0951005 Narva Laste Loomemaja T;8955911
48605152217;0951005 Narva Laste Loomemaja T;8955924
61105243720;0951005 Narva Laste Loomemaja T;8958468
51011070087;0951005 Narva Laste Loomemaja T;8958484
60503103719;0951005 Narva Laste Loomemaja T;8958714
46002203737;0951005 Narva Laste Loomemaja T;8960045
46005153715;0951005 Narva Laste Loomemaja T;8960058
61012013750;0951005 Narva Laste Loomemaja T;8960090
61107113725;0951005 Narva Laste Loomemaja T;8960100
60307183723;0951005 Narva Laste Loomemaja T;8960197
61401070194;0951005 Narva Laste Loomemaja T;8961358
61203253720;0951005 Narva Laste Loomemaja T;8962195
50108243710;0951005 Narva Laste Loomemaja T;8962221
51403120032;0951005 Narva Laste Loomemaja T;8962276
51107203734;0951005 Narva Laste Loomemaja T;8962289
60601037029;0951005 Narva Laste Loomemaja T;8962357
60804023730;0951005 Narva Laste Loomemaja T;8963369
60609303711;0951005 Narva Laste Loomemaja T;8963437
50708173710;0951005 Narva Laste Loomemaja T;8963440
61502270126;0951005 Narva Laste Loomemaja T;8963466
50304163748;0951005 Narva Laste Loomemaja T;8963712
51308090184;0951005 Narva Laste Loomemaja T;8964999
51309300144;0951005 Narva Laste Loomemaja T;8965040
51304010206;0951005 Narva Laste Loomemaja T;8965053
60812093718;0951005 Narva Laste Loomemaja T;8965079
51309300133;0951005 Narva Laste Loomemaja T;8965257
60311073717;0951005 Narva Laste Loomemaja T;8965273
61309300123;0951005 Narva Laste Loomemaja T;8965655
51309120190;0951005 Narva Laste Loomemaja T;8965707
61401070194;0951005 Narva Laste Loomemaja T;8965710
61307300113;0951005 Narva Laste Loomemaja T;8965859
44409233713;0951005 Narva Laste Loomemaja T;8967019
61407190091;0951005 Narva Laste Loomemaja T;8967873
60604072217;0951005 Narva Laste Loomemaja T;8970307
51005097096;0951005 Narva Laste Loomemaja T;8970608
61404100079;0951005 Narva Laste Loomemaja T;8970954
61312240049;0951005 Narva Laste Loomemaja T;8970967
61401070194;0951005 Narva Laste Loomemaja T;8971005
60902133725;0951005 Narva Laste Loomemaja T;8971063
60906163711;0951005 Narva Laste Loomemaja T;8971377
51410080100;0951005 Narva Laste Loomemaja T;8971490
60603233727;0951005 Narva Laste Loomemaja T;8971597
49705153714;0951005 Narva Laste Loomemaja T;8971872
50810227125;0951005 Narva Laste Loomemaja T;8971898
51203053730;0951005 Narva Laste Loomemaja T;8972185
51501280182;0951005 Narva Laste Loomemaja T;8972431
51412010105;0951005 Narva Laste Loomemaja T;8972460
60008253737;0951005 Narva Laste Loomemaja T;8972499
50106213712;0951005 Narva Laste Loomemaja T;8972512
51202283724;0951005 Narva Laste Loomemaja T;8972680
60903273717;0951005 Narva Laste Loomemaja T;8973634
61409110187;0951005 Narva Laste Loomemaja T;8974183
60110113758;0951005 Narva Laste Loomemaja T;8974442
60805213718;0951005 Narva Laste Loomemaja T;8974455
50809123760;0951005 Narva Laste Loomemaja T;8974701
60707173717;0951005 Narva Laste Loomemaja T;8974837
50411123734;0951005 Narva Laste Loomemaja T;8975111
51208073757;0951005 Narva Laste Loomemaja T;8975137
50409023731;0951005 Narva Laste Loomemaja T;8975690
61402060072;0951005 Narva Laste Loomemaja T;8976107
50711123710;0951005 Narva Laste Loomemaja T;8976275
61504250133;0951005 Narva Laste Loomemaja T;8976356
61210043712;0951005 Narva Laste Loomemaja T;8976903
60904223734;0951005 Narva Laste Loomemaja T;8976916
61110043711;0951005 Narva Laste Loomemaja T;8976932
60701153740;0951005 Narva Laste Loomemaja T;8977290
61011193719;0951005 Narva Laste Loomemaja T;8977973
60102133712;0951005 Narva Laste Loomemaja T;8978134
60005083731;0951005 Narva Laste Loomemaja T;8978147
60604243717;0951005 Narva Laste Loomemaja T;8978163
60610293725;0951005 Narva Laste Loomemaja T;8978202
60012283732;0951005 Narva Laste Loomemaja T;8978383
60408303720;0951005 Narva Laste Loomemaja T;8981707
51001073716;0951005 Narva Laste Loomemaja T;8982175
51008243720;0951005 Narva Laste Loomemaja T;8982272
61103183721;0951005 Narva Laste Loomemaja T;8982285
50610093756;0951005 Narva Laste Loomemaja T;8982311
60805083744;0951005 Narva Laste Loomemaja T;8982382
50711087059;0951005 Narva Laste Loomemaja T;8983721
60704257105;0951005 Narva Laste Loomemaja T;8984115
61003023736;0951005 Narva Laste Loomemaja T;8984788
60403303717;0951005 Narva Laste Loomemaja T;8984843
60402182737;0951005 Narva Laste Loomemaja T;8984898
50710023721;0951005 Narva Laste Loomemaja T;8984908
60905263734;0951005 Narva Laste Loomemaja T;8984937
50711133728;0951005 Narva Laste Loomemaja T;8985237
60705092773;0951005 Narva Laste Loomemaja T;8985392
50407283742;0951005 Narva Laste Loomemaja T;8985538
61401070194;0951005 Narva Laste Loomemaja T;8986184
61103043731;0951005 Narva Laste Loomemaja T;8986579
51312110021;0951005 Narva Laste Loomemaja T;8986689
60811173716;0951005 Narva Laste Loomemaja T;8986715
50908123725;0951005 Narva Laste Loomemaja T;8986728
51407040125;0951005 Narva Laste Loomemaja T;8986786
51307220218;0951005 Narva Laste Loomemaja T;8986841
61310040016;0951005 Narva Laste Loomemaja T;8987358
60603243745;0951005 Narva Laste Loomemaja T;8987374
50401163747;0951005 Narva Laste Loomemaja T;8987549
60404073720;0951005 Narva Laste Loomemaja T;8987730
61403050081;0951005 Narva Laste Loomemaja T;8988056
61311300142;0951005 Narva Laste Loomemaja T;8988085
50402273743;0951005 Narva Laste Loomemaja T;8988166
48309052299;0951005 Narva Laste Loomemaja T;8988292
50409023731;0951005 Narva Laste Loomemaja T;8988302
60908253712;0951005 Narva Laste Loomemaja T;8988629
60912133731;0951005 Narva Laste Loomemaja T;8988645
60511303714;0951005 Narva Laste Loomemaja T;8988726
60805063730;0951005 Narva Laste Loomemaja T;8988771
60011273719;0951005 Narva Laste Loomemaja T;8988807
60102153737;0951005 Narva Laste Loomemaja T;8988865
60204303738;0951005 Narva Laste Loomemaja T;8988881
50405133713;0951005 Narva Laste Loomemaja T;8989398
60408303720;0951005 Narva Laste Loomemaja T;8989424
50412293717;0951005 Narva Laste Loomemaja T;8990057
50701273714;0951005 Narva Laste Loomemaja T;8990442
60304013730;0951005 Narva Laste Loomemaja T;8990646
60305030039;0951005 Narva Laste Loomemaja T;8990659
50812193712;0951005 Narva Laste Loomemaja T;8990688
60011273720;0951005 Narva Laste Loomemaja T;8990701
60702273720;0951005 Narva Laste Loomemaja T;8990727
50511293737;0951005 Narva Laste Loomemaja T;8990866
60403133715;0951005 Narva Laste Loomemaja T;8990992
60501087028;0951005 Narva Laste Loomemaja T;8991250
50104273722;0951005 Narva Laste Loomemaja T;8991263
60503113737;0951005 Narva Laste Loomemaja T;8991386
60501103731;0951005 Narva Laste Loomemaja T;8991467
60708193725;0951005 Narva Laste Loomemaja T;8991535
60211193712;0951005 Narva Laste Loomemaja T;8991661
50205113726;0951005 Narva Laste Loomemaja T;8992136
60611173710;0951005 Narva Laste Loomemaja T;8992217
60904123717;0951005 Narva Laste Loomemaja T;8992246
48902063710;0951005 Narva Laste Loomemaja T;8992288
61009283710;0951005 Narva Laste Loomemaja T;8992534
60701153739;0951005 Narva Laste Loomemaja T;8992589
49501013715;0951005 Narva Laste Loomemaja T;8992738
50204163734;0951005 Narva Laste Loomemaja T;8992741
60410123730;0951005 Narva Laste Loomemaja T;8992770
51208183726;0951005 Narva Laste Loomemaja T;8992893
50809163722;0951005 Narva Laste Loomemaja T;8992958
61101153734;0951005 Narva Laste Loomemaja T;8992961
50906183724;0951005 Narva Laste Loomemaja T;8993012
60902257058;0951005 Narva Laste Loomemaja T;8993290
60108223724;0951005 Narva Laste Loomemaja T;8993481
61109040084;0951005 Narva Laste Loomemaja T;8993546
60510113737;0951005 Narva Laste Loomemaja T;8993698
50311043728;0951005 Narva Laste Loomemaja T;8993766
60704163717;0951005 Narva Laste Loomemaja T;8993779
61307160034;0951005 Narva Laste Loomemaja T;8993863
61306140026;0951005 Narva Laste Loomemaja T;8993889
60603313719;0951005 Narva Laste Loomemaja T;8994286
60512143724;0951005 Narva Laste Loomemaja T;8994626
50605083715;0951005 Narva Laste Loomemaja T;8994817
50112203711;0951005 Narva Laste Loomemaja T;8995049
50201073720;0951005 Narva Laste Loomemaja T;8995078
60311073717;0951005 Narva Laste Loomemaja T;8995120
50209013718;0951005 Narva Laste Loomemaja T;8995146
50102163710;0951005 Narva Laste Loomemaja T;8995269
50204163734;0951005 Narva Laste Loomemaja T;8995285
60507153752;0951005 Narva Laste Loomemaja T;8995340
60311073717;0951005 Narva Laste Loomemaja T;8995379
60310133712;0951005 Narva Laste Loomemaja T;8995638
45405173717;0951005 Narva Laste Loomemaja T;8995683
60705253710;0951005 Narva Laste Loomemaja T;8995764
51006093711;0951005 Narva Laste Loomemaja T;8996064
50712260257;0951005 Narva Laste Loomemaja T;8996103
50402273743;0951005 Narva Laste Loomemaja T;8996116
61311120081;0951005 Narva Laste Loomemaja T;8996132
50204163734;0951005 Narva Laste Loomemaja T;8996336
50603273732;0951005 Narva Laste Loomemaja T;8996378
61211303718;0951005 Narva Laste Loomemaja T;8996860
51302030014;0951005 Narva Laste Loomemaja T;8996909
61301060012;0951005 Narva Laste Loomemaja T;8996912
51304220225;0951005 Narva Laste Loomemaja T;8996967
60905183720;0951005 Narva Laste Loomemaja T;8997157
60307053740;0951005 Narva Laste Loomemaja T;8997209
61104153738;0951005 Narva Laste Loomemaja T;8997416
61106153726;0951005 Narva Laste Loomemaja T;8998114
61310110045;0911012 Narva Lasteaed Kaseke T;9120075
61212280204;0911012 Narva Lasteaed Kaseke T;9120127
51305030138;0911012 Narva Lasteaed Kaseke T;9120172
51302160030;0911012 Narva Lasteaed Kaseke T;9120198
61308100150;0911012 Narva Lasteaed Kaseke T;9120208
61310300083;0911012 Narva Lasteaed Kaseke T;9120240
23082017999;0911027 Narva Lasteaed Pongerjas T;9277135
99999999999;0911034 Narva Lasteaed Kirsike T;9349995
99996160320;0911036 Narva Lasteaed Vikerkaar T;9366554
$$, '\n') AS l) t;
*/
DROP FUNCTION IF EXISTS lapsed.kustuta_vn();

CREATE FUNCTION lapsed.kustuta_vn()
    RETURNS INTEGER
    LANGUAGE plpgsql
AS
$$
DECLARE
    v_vn      RECORD;
    l_count   INTEGER = 0;
    l_rekv_id INTEGER;
    l_kokku   INTEGER = 0;
    l_vn      TEXT;
    l_ik      TEXT;
    l_id      INTEGER;
BEGIN
    -- UdalenieVN2020.xlsx - у этих детей надо удалить только ВН, приведенные в этом файле
    FOR v_vn IN
        SELECT replace(vn, E'\n', '') AS vn1,
               regexp_replace(vn, E'(^[\\n\\r]+)|([\\n\\r]+$)', '', 'g') as vn,
               ik,
               asutus
        FROM tmp_viitenr_kustuta
        WHERE vn IS NOT NULL
        LOOP
            l_rekv_id = (SELECT id FROM ou.rekv WHERE left(nimetus, 10) = left(v_vn.asutus, 10) LIMIT 1);
            l_vn = replace(v_vn.vn, E'\n', '');
            l_ik = v_vn.ik;
            l_id = (SELECT id
                    FROM lapsed.viitenr
                    WHERE ltrim(rtrim(isikukood)) = ltrim(rtrim(l_ik))
                      AND rekv_id = l_rekv_id
                      AND ltrim(rtrim(viitenumber)) = ltrim(rtrim(l_vn))
                    LIMIT 1);
            IF l_rekv_id IS NULL
            THEN
                RAISE EXCEPTION 'Puudub l_rekv_id %', v_vn;
            END IF;
            RAISE NOTICE 'Kustutan  l_rekv_id %, l_id %, l_ik %, l_vn %, %', l_rekv_id, l_id, l_ik, l_vn, v_vn;

            DELETE
            FROM lapsed.viitenr
            WHERE ltrim(rtrim(isikukood)) = ltrim(rtrim(v_vn.ik))
              AND rekv_id = l_rekv_id
              AND ltrim(rtrim(viitenumber)) = ltrim(rtrim(v_vn.vn));
--                AND viitenumber = trim(replace(v_vn.vn,E'\n',''),'"');

            GET DIAGNOSTICS l_count = ROW_COUNT;
            IF l_count > 0
            THEN
                RAISE NOTICE 'Deleted total: l_kokku %', l_kokku;
                l_kokku = l_kokku + 1;
            END IF;
        END LOOP;
    RETURN l_kokku;

END;
$$;

SELECT lapsed.kustuta_vn();

DROP FUNCTION IF EXISTS lapsed.kustuta_vn();

/*
 select trim(replace(vn,E'\n',''),'"'), vn, ik, asutus from tmp_viitenr_kustuta

SELECT id FROM ou.rekv WHERE left(nimetus, 10) = left(trim('"0911027 Narva Lasteaed Pongerjas T"','"'), 10) LIMIT 1

          FROM lapsed.viitenr
            WHERE isikukood = v_vn.ik
              AND rekv_id = l_rekv_id
              AND viitenumber = trim(replace(v_vn.vn,E'\n',''),'"');

select * from tmp_viitenr_kustuta
 where vn = '9366554'

 */
